<html>

<head></head>

<body></body>

<style>
    div {
        display: block;
    }
</style>

<script>
    (function () {
        window.nodes = { "": document.body };

        window.on_click = (id) => (event) => {
            var click = { "Click": { "id": id } };
            console.log(JSON.stringify(click));
        };

        window.on_change = (id, element) => (event) => {
            var change = { "Change": { "id": id, "value": element.value } };
            console.log(JSON.stringify(change));
        };

        window.on_command = (cmd) => {
            var cmd = JSON.parse(cmd);

            if (cmd.hasOwnProperty('Create')) {
                var create = cmd['Create'];

                var id = create.id;
                var parent = create.parent;

                var kind = create.kind;
                var attributes = create.attributes;

                var node = null;
                if (kind == "Div") {
                    node = document.createElement("div");
                } else if (kind == "Button") {
                    node = document.createElement('button');
                    node.appendChild(document.createTextNode(attributes['Text']));
                    node.onclick = window.on_click(id);
                } else if (kind == "Input") {
                    node = document.createElement('input');
                    // Object.entries(attributes).forEach((name, value) => {
                    //     if (name == "Placeholder") {
                    //         node.placeholder = value;
                    //     }
                    // })

                    if (attributes['Placeholder']) {
                        node.placeholder = attributes['Placeholder'];
                    }

                    node.onchange = node.onkeypress = node.onpaste = node.oninput = window.on_change(id, node);
                } else {
                    node = document.createTextNode(attributes['Text']);
                }

                var parent = window.nodes[parent];
                parent.appendChild(node);

                window.nodes[id] = node;
            } else if (cmd.hasOwnProperty('Update')) {
                var update = cmd['Update'];

                var id = update.id;

                var attribute = update.attribute;
                var value = update.value;

                if (attribute == "Text") {
                    window.nodes[id].nodeValue = value;
                } else {
                    // Unsupported attribute!
                }
            } else if (cmd.hasOwnProperty('Remove')) {
                var remove = cmd['Remove'];
                var id = remove.id;

                window.nodes[id].remove();
            }
        };
    })();
</script>

</html>